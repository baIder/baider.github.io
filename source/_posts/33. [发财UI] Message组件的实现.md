---
title: å‘è´¢UI Messageç»„ä»¶çš„å®ç°
date: 2022-07-30 15:29:14
tags: - Vue
---

# \[å‘è´¢UI] Messageç»„ä»¶çš„å®ç°

## å‰è¨€

æœ€è¿‘åœ¨å®ç°Messageç»„ä»¶ï¼Œå°±æ˜¯ä¼šä»å±å¹•é¡¶ç«¯å¼¹å‡ºçš„ä¸€ä¸ªå°æé†’ï¼Œè¿‡ä¸€ä¼šå„¿å°±æ¶ˆå¤±äº†ã€‚æˆ‘ä¸ªäººéå¸¸å–œæ¬¢è¿™ä¸ªè®¾è®¡ï¼Œæ„Ÿè§‰åœ¨åç»­çš„å¤ç”¨æ€§ä¹Ÿå¾ˆé«˜ï¼Œäºæ˜¯å°±æ‰“ç®—è‡ªå·±æ‰‹å†™ä¸€ä¸ªä½œä¸º[å‘è´¢UI](git.balder.wang/rich-ui-website/ "å‘è´¢UI")çš„ç»„ä»¶

## æ”¯æŒçš„åŠŸèƒ½

ç›®å‰çš„Messageæœ‰å››ç§ç±»å‹ï¼š

1.  æ™®é€šæé†’normal

    ![](https://img.bald3r.wang/img/normal.gif)
2.  æˆåŠŸæé†’success

    ![](https://img.bald3r.wang/img/success.gif)
3.  è­¦å‘Šæé†’warning

    ![](https://img.bald3r.wang/img/warning.gif)
4.  é”™è¯¯æé†’error

    ![](https://img.bald3r.wang/img/error.gif)

åŒæ—¶è¿˜æ”¯æŒè®¾ç½®æŒç»­çš„æ—¶é—´ï¼š

![](https://img.bald3r.wang/img/10s.gif)

## ä½¿ç”¨æ–¹æ³•

æ˜¯ä¸æ˜¯éå¸¸ç®€å•ğŸ˜‰

```javascript
<template>
  <div>
    <button @click="popNormalMsg">æ‰“å¼€ä¸€ä¸ªæ™®é€šæé†’</button>
  </div>
</template>

<script lang="ts">
import {popMessage} from "../../lib/popMessage";

export default {
  name: "Message1.demo",
  components: {Button},
  setup() {
    const popNormalMsg = () => {
      popMessage({
        message: 'è¿™æ˜¯ä¸€ä¸ªå…¨å±€æ˜¾ç¤ºçš„æ™®é€šæé†’',   //æé†’å†…å®¹
        msgType: 'normal',   //æé†’ç±»å‹normal success error warning
        closeDelay: '2000',  //æ˜¾ç¤ºçš„æ—¶é•¿ï¼Œä»¥msä¸ºå•ä½
      })
    }
    return {popNormalMsg}
  }
}
</script>
```

## å®ç°è¿‡ç¨‹

### å¦‚ä½•å®ç°ä¸åŒç±»å‹çš„åˆ‡æ¢ï¼Ÿ

å…¶å®åˆ‡æ¢ç±»å‹åªæ˜¯åˆ‡æ¢å›¾æ ‡è€Œå·²å“ˆå“ˆå“ˆ

è¿™é‡Œä½¿ç”¨äº†[IconParkå›¾æ ‡åº“](https://iconpark.oceanengine.com/official "IconParkå›¾æ ‡åº“")ï¼Œè¿™é‡Œä½¿ç”¨äº†ä¸€ä¸ªæŠ•æœºå–å·§çš„åŠæ³•ï¼ŒæŠŠä¸åŒçš„å›¾æ ‡å‘½åä¸ºç›¸åº”çš„typeï¼Œå¯ä»¥èŠ‚çœä¸€äº›å¤„ç†çš„æ­¥éª¤

| `href=#warning` | `msgType='warning'` |
| --------------- | ------------------- |
| `href=#error`   | `msgType='error'`   |

```javascript
const typeIndicator = `<use href="#${props.msgType}"></use>`
```

```javascript
<template>
  <div ref="msgDiv" class="rich-message">
    <svg class="iconpark-icon" v-html="typeIndicator">
      //2ï¸âƒ£typeIndicatorçš„å†…å®¹ä¼šåŸå°ä¸åŠ¨çš„è·‘åˆ°è¿™é‡Œ
    </svg>
    //3ï¸âƒ£æœ€åå’Œsvgæ ‡ç­¾ä¸€èµ·å˜æˆtypeå¯¹åº”çš„å›¾æ ‡
    <div class="rich-message-msgText">{{ message }}</div>
  </div>
</template>

<script lang="ts">

export default {
  name: "Message",
  props: {
    message: {
      type: String,
      required: true,
    },
    msgType: {
      type: String,
      default: 'normal',
    },
  },
  setup(props) {
    const typeIndicator = `<use href="#${props.msgType}"></use>`
    return {typeIndicator}
    //1ï¸âƒ£æ¥å—åˆ°ä¼ æ¥çš„typeï¼Œç„¶åtypeIndicatorä¼šè‡ªåŠ¨å˜ä¸ºç›¸åº”çš„å›¾æ ‡useæ ‡ç­¾
  }
}
</script>

```

### å¦‚ä½•å®ç°Messageçš„å¼¹å‡ºå’Œæ¶ˆå¤±ï¼Ÿ

ä½¿ç”¨äº†CSSçš„`transform`ï¼Œå®é™…ä¸Šå°±æ˜¯Messageåœ¨åˆå§‹çŠ¶æ€ä¸‹æ˜¯è—åœ¨ç”»é¢å¤–çš„ï¼Œé€šè¿‡æ·»åŠ ä¸€ä¸ª`.message-active`çš„ç±»æ¥è®©å®ƒæ˜¾ç¤ºå‡ºæ¥ï¼Œåœ¨ç»è¿‡`closeDelay`æ¯«ç§’åç§»é™¤`.message-active`ç±»ã€‚

```css
.rich-message {
  ...
  transform: translateY(-100px);
  transition: all 250ms;

  &.message-active {
    transform: translateY(0px);
    opacity: 1;
  }
}
```

### å¦‚ä½•å®ç°å¾€ä¸‹æ’åˆ—è€Œéå †å ï¼Ÿ

ä¸ºäº†è®©ä»–ä»¬èƒ½å¤Ÿä¸€ä¸ªä¸€ä¸ªçš„æ’åˆ—ä¸‹æ¥è€Œä¸æ˜¯å †å åœ¨ä¸€èµ·ï¼Œæˆ‘æƒ³åˆ°äº†`insertAdjacentElement()`æ–¹æ³•

```javascript
element.insertAdjacentElement(position, element);
```

positionæœ‰ä¸‹é¢å››ç§å–å€¼

-   `'beforebegin'`: åœ¨è¯¥å…ƒç´ æœ¬èº«çš„å‰é¢ã€‚
-   `'afterbegin'`:åªåœ¨è¯¥å…ƒç´ å½“ä¸­ï¼Œåœ¨è¯¥å…ƒç´ ç¬¬ä¸€ä¸ªå­å­©å­å‰é¢ã€‚
-   `'beforeend'`:åªåœ¨è¯¥å…ƒç´ å½“ä¸­ï¼Œåœ¨è¯¥å…ƒç´ æœ€åä¸€ä¸ªå­å­©å­åé¢ã€‚
-   `'afterend'`: åœ¨è¯¥å…ƒç´ æœ¬èº«çš„åé¢ã€‚

ä¸éš¾å‘ç°è¿™é‡Œä¼¼ä¹å¯ä»¥ä½¿ç”¨`beforeend`å’Œ`afterend`ã€‚ç»è¿‡æˆ‘çš„æ€è€ƒï¼Œä¸ºäº†ä¿æŒDOMæ ‘çš„æ•´æ´ï¼Œæˆ‘é‡‡ç”¨äº†åˆ›å»ºä¸€ä¸ª`msgContainer`çš„divæ¥å­˜æ”¾æ‰€æœ‰çš„Messageçš„æ–¹æ³•ï¼Œå› æ­¤æˆ‘ä¹Ÿç›¸åº”çš„ä½¿ç”¨äº†`beforeend`

```javascript
let msgContainer = document.getElementById('msgDiv')
if (msgContainer === null) {
  msgContainer = document.createElement('div')
  msgContainer.id = 'msgDiv'
  document.body.appendChild(msgContainer)
}
const div = document.createElement('div'); //è¿™ä¸ªdivå°±æ˜¯Messageæ‰€åœ¨çš„div
msgContainer.insertAdjacentElement('beforeend', div)
```

ç»™`msgContainer`ä¸€ä¸ªCSSæ ·å¼

```css
#msgDiv {
  position: absolute;
  top: 0;
  left: 50%;
  transform: translateX(-50%);

  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
}
```

### å¦‚ä½•å®ç°æ·»åŠ å’Œç§»é™¤`.message-active`ç±»ï¼Ÿ

å¦‚æœ`msgDiv`åœ¨åˆ›å»ºæ—¶å°±å¸¦æœ‰`.message-active`ç±»ï¼Œé‚£ä¹ˆå°†ä¼šé—ªç°åœ¨é¡µé¢ä¸­ï¼Œæ‰€ä»¥`msgDiv`åº”è¯¥æ˜¯åœ¨æ¸²æŸ“åè¢«æ·»åŠ äº†`.message-active`ç±»ï¼Œä¸ºäº†å®ç°è¿™ä¸ªæ•ˆæœï¼Œä½¿ç”¨äº†ä¸€ä¸ª`setTimeout()`ã€‚

åŒæ—¶åœ¨`closeDelay`ä¹‹åå°†è¿™ä¸ªç±»ç§»é™¤ã€‚

ä½†æ˜¯è¿™æ ·å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œè¿™ä¸ª`msgDiv`åªæ˜¯çœ‹ä¸è§äº†ï¼Œä¾ç„¶å­˜åœ¨äºDOMæ ‘ä¸­ã€‚

```javascript
setTimeout(() => {
    msgDiv.classList.add('message-active')
}, 0)

setTimeout(() => {
    msgDiv.classList.remove('message-active')
}, closeDelay * 1);

```

### å¦‚ä½•å°†éšè—çš„Messageä»DOMæ ‘ä¸­ç§»é™¤

åœ¨Messageçš„æ·¡å‡ºåŠ¨ç”»ç»“æŸåç§»é™¤å°±å¥½äº†ï¼Œè¿™é‡Œä½¿ç”¨äº†`.ontransitionend`APIï¼Œä½†æ˜¯è¿˜å­˜åœ¨é—®é¢˜ï¼Œå³å¦‚æœæœ‰å¤šä¸ªMessageï¼Œä»–ä»¬ä¼šåŒæ—¶æ¶ˆå¤±ï¼ŒåŸå› æ˜¯è™½ç„¶æ¯ä¸ªMessageåœ¨åˆ›å»ºæ—¶éƒ½ä¼šæœ‰ä¸€ä¸ªè®¡æ—¶å™¨ï¼Œä½†æ˜¯åœ¨ç§»é™¤æ—¶å´æ˜¯æ‰€æœ‰çš„msgDivä¸€èµ·ç§»é™¤ï¼Œå› æ­¤éœ€è¦æœ‰åŒºåˆ†çš„æ–¹æ³•ã€‚

```javascript
setTimeout(() => {
    msgDiv.classList.remove('message-active')
    msgDiv.ontransitionend = () => {
      app.unmount();
      div.remove();
    }
}, closeDelay * 1);
```

### å¦‚ä½•åŒºåˆ†ä¸åŒçš„Messageï¼Ÿ

åœ¨æœ¬é¡¹ç›®ä¸­ï¼Œæˆ‘ä½¿ç”¨äº†éšæœºç”ŸæˆIDçš„æ–¹å¼ï¼Œå¦‚æ­¤ä¸€ç•ªå°±èƒ½ç²¾å‡†çš„æ§åˆ¶æ¯ä¸ª`msgDiv`

```javascript
function randomLetter(len) {
  let str = '';
  for (let i = 0; i < len; i++) {
    str += String.fromCharCode(~~(Math.random() * 26 + 65));
  }
  return str;
}

const msgId = randomLetter(~~(Math.random() * 10 + 30)) //ç”Ÿæˆäº†ä¸€ä¸ªéšæœºå­—ç¬¦ä¸²
const app = createApp({
  render() {
    return h(Message, {
      message,
      msgType,
      id: msgId,
     });
  }
});
app.mount(div);

const msgDiv = document.getElementById(String(msgId))

setTimeout(() => {
    msgDiv.classList.add('message-active')
}, 0)

setTimeout(() => {
    msgDiv.classList.remove('message-active')
    msgDiv.ontransitionend = () => {
      app.unmount();
      div.remove();
    }
}, closeDelay * 1);

```

### æœ€åçš„ä¸€ä¸ªå°ç»†èŠ‚

æˆ‘ä»¬ä½¿ç”¨äº†ä¸€ä¸ª`msgContainer`å°†æ‰€æœ‰çš„MessageåŒ…è£¹çš„èµ·æ¥ï¼Œä»è€Œå®ç°é¡ºåºæ’åˆ—ï¼Œä½†æ˜¯åœ¨æœ€åä¸€ä¸ªMessageæ¶ˆå¤±åï¼Œ`msgContainer`ä¼šä½œä¸ºä¸€ä¸ªç©ºçš„divä»ç„¶å­˜åœ¨äºDOMæ ‘ä¸­ï¼Œè¿™å¾ˆä¸ç¯ä¿ï¼Œå› æ­¤åœ¨æœ€åä¸€ä¸ªMessageæ¶ˆå¤±åå°†`msgContainer`ä¹Ÿä¸€å¹¶ç§»é™¤

```javascript
setTimeout(() => {
  msgDiv.classList.remove('message-active')
  msgDiv.ontransitionend = () => {
     app.unmount();
     div.remove();
     if (msgContainer.children.length === 0) {
       msgContainer.remove()
     }
  }
}, closeDelay * 1);
```

## åè®°

ä»¥ä¸Šå°±æ˜¯æˆ‘å†™Messageç»„ä»¶æ—¶çš„æ‰€æœ‰æ€è·¯ï¼Œå¦‚æœä½ æœ‰æ›´å¥½çš„æƒ³æ³•ï¼Œæ¬¢è¿ç•™è¨€å‘Šè¯‰æˆ‘å‘€\~
