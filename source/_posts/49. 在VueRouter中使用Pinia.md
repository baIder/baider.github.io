---
title: åœ¨VueRouterä¸­ä½¿ç”¨Pinia
date: 2023-01-23 15:29:14
tags: 
  - Vue
---

# åœ¨VueRouterä¸­ä½¿ç”¨Pinia

2023 å¹´ 9 æœˆ 18 æ—¥æ›´æ–°ï¼š

ç»è¿‡è¯„è®ºæé†’ï¼ŒPinia å®˜æ–¹æ–‡æ¡£å·²ç»æä¾›äº†è§£å†³æ–¹æ¡ˆï¼Œå…·ä½“è¯·å‚è€ƒ[å®˜æ–¹æ–‡æ¡£](https://pinia.vuejs.org/zh/core-concepts/outside-component-usage.html)

ä¸€è¨€ä»¥è”½ä¹‹ï¼Œåœ¨ Pinia å®ä¾‹åŒ–ä¹‹åå†ä½¿ç”¨ 

# å‰è¨€

ç›®å‰Vue3+Vite+Pinia+VueRouterçš„ç»„åˆå·²ç»éå¸¸æµè¡Œäº†ï¼Œä½†æ˜¯åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­ä¹Ÿå‘ç°äº†ä¸€ä¸ªå°å°çš„é—®é¢˜ï¼Œå³åœ¨VueRouterä¸­ä½¿ç”¨Piniaä¼šæŠ¥é”™ï¼Œåæ¥ç»è¿‡ä¸€ç•ªç ”(bai)ç©¶(du)æ‰¾åˆ°äº†è§£å†³æ–¹æ³•

æŠ¥é”™æ–‡å­—ï¼š

> Uncaught Error: \[ğŸ]: getActivePinia was called with no active Pinia. Did you forget to install pinia?
> const pinia = createPinia()
> app.use(pinia)
> This will fail in production.

# é—®é¢˜å¤ç°

## demoç»“æ„

![](https://balder-wang-images.oss-cn-shanghai.aliyuncs.com/img/202301131135400.png)

## ä»£ç å‘ˆç°

```javascript
//counter.js
import { ref, computed } from 'vue'
import { defineStore } from 'pinia'

export const useCounterStore = defineStore('counter', () => {
  const count = ref(0)
  const doubleCount = computed(() => count.value * 2)
  function increment() {
    count.value++
  }

  return { count, doubleCount, increment }
})


//router/index.js
import { createRouter, createWebHistory } from 'vue-router'
import HomeView from '../views/HomeView.vue'
import {useCounterStore} from '@/stores/counter'

const counterStore=useCounterStore()
const router = createRouter({
  history: createWebHistory(import.meta.env.BASE_URL),
  routes: [
    {
      path: '/',
      name: 'home',
      component: HomeView
    },
    {
      path: '/about',
      name: 'about',
      component: () => import('../views/AboutView.vue')
    }
  ]
})

router.beforeEach((to,from)=>{
  console.log(to.name)
  console.log(from.name)
})

export default router

```

## æŠ¥é”™æç¤º

![](https://balder-wang-images.oss-cn-shanghai.aliyuncs.com/img/202301131137003.png)

åˆæ­¥æ¨æµ‹æ˜¯å› ä¸ºåˆå§‹åŒ–VueRouterçš„æ—¶æœºæ¯”åˆå§‹åŒ–Piniaçš„æ—¶æœºæ›´æ—©

# è§£å†³æ–¹æ³•

1.  å•ç‹¬å¯¼å‡ºpinia

    ![](https://balder-wang-images.oss-cn-shanghai.aliyuncs.com/img/202301131141331.png)

    æ–°å»ºäº†ä¸€ä¸ªpinia.js
    ```javascript
    //pinia.js
    import {createPinia} from 'pinia';

    const pinia = createPinia();

    export default pinia;

    ```
2.  åœ¨å¼•ç”¨åˆ°storeçš„åœ°æ–¹ä½¿ç”¨pinia.js
    ```javascript
    //router/index.js
    import { createRouter, createWebHistory } from 'vue-router'
    import HomeView from '../views/HomeView.vue'
    import {useCounterStore} from '@/stores/counter'
    import pinia from '@/stores/pinia'

    const counterStore=useCounterStore(pinia) //åœ¨æ­¤å¤„ä¼ å…¥pinia
    const router = createRouter({
    ......
    })

    export default router

    ```

é—®é¢˜è§£å†³ï¼

# åè®°

ç›®å‰å®˜æ–¹æ–‡æ¡£å¹¶æ²¡æœ‰æä¾›ç›¸åº”çš„è§£å†³æ–¹æ¡ˆï¼Œç›®å‰è¿™ä¸ªæ–¹æ³•ä¸æ˜¯å¾ˆä¼˜é›…ï¼Œä½†æ˜¯èƒ½å¤Ÿè§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒæœŸå¾…å…¶ä»–çš„è§£å†³æ–¹æ³•ï¼
